# ä½¿ç”¨ Taro3 + Vue3 å¼€å‘å¾®ä¿¡å°ç¨‹åº

## å‰è¨€

å¾®ä¿¡å°ç¨‹åºæ˜¯ä»¥å¾®ä¿¡ä¸ºè¿è¡Œç¯å¢ƒçš„ä¸€ç§åº”ç”¨ï¼Œå…¶å®è´¨æ˜¯ `Hybrid` æŠ€æœ¯çš„åº”ç”¨ï¼ŒHybrid App å³æ··åˆæ¨¡å¼ç§»åŠ¨åº”ç”¨ï¼Œå› æ­¤ä¸ `H5` ç±»ä¼¼ï¼Œä½†åˆæ¯” H5 æ‹¥æœ‰å¾ˆå¤šåŸç”Ÿçš„èƒ½åŠ›ï¼Œä¾‹å¦‚è°ƒç”¨ä½ç½®ä¿¡æ¯å’Œæ‘„åƒå¤´ç­‰ã€‚

å°ç¨‹åºçš„å¼€å‘æ–¹å¼ä¸ H5 ååˆ†ç›¸ä¼¼ï¼Œç”¨çš„ä¹Ÿæ˜¯ Â `JavaScript`ã€`HTML`ã€`CSS`Â  è¯­è¨€ã€‚

å› æ­¤ï¼Œå°ç¨‹åºå¼€å‘å¯ä»¥è¯´æ˜¯ä¸€åå‰ç«¯å·¥ç¨‹å¸ˆå¿…é¡»è¦æŒæ¡çš„æŠ€èƒ½ã€‚

åŸç”Ÿå°ç¨‹åºå¼€å‘æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œç°å¦‚ä»Šå¸‚é¢ä¸Šæœ‰å¾ˆå¤šå¼€å‘å°ç¨‹åºçš„ç¬¬ä¸‰æ–¹å¤šç«¯æ¡†æ¶ï¼Œå¦‚æœä¸æ˜¯è¿½æ±‚æè‡´æ€§èƒ½å’Œç¨³å®šï¼Œè¿˜æ˜¯ä¸è¦ç”¨åŸç”Ÿå°ç¨‹åºå¼€å‘äº†ï¼Œå¼€å‘æ•ˆç‡å¤ªä½ã€‚

ç¬¬ä¸‰æ–¹å¤šç«¯æ¡†æ¶ä¸­ï¼Œ`taro` å’Œ `uni-app` çš„ä½¿ç”¨åº¦æ˜¯æœ€å¹¿çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒåšæŠ€æœ¯é€‰å‹æ—¶ï¼Œå›¢é˜Ÿç”¨ `react`ï¼Œå°±ç”¨ taroï¼Œå›¢é˜Ÿç”¨ `vue`ï¼Œå°±ç”¨ uni-appï¼Œä¸¤è€…ä¹‹é—´æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ£ä¹‹åˆ†ï¼Œéƒ½æŒºå¥½ç”¨çš„ã€‚

ä½†å¾ˆå¤šå¼€å‘è€…å¯èƒ½ä¸çŸ¥é“ï¼Œtaro3.0 ä»¥ä¸Šç‰ˆæœ¬æ˜¯æ”¯æŒä½¿ç”¨ vue çš„ï¼Œæœ¬ç¯‡æ–‡ç« å°±æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Taro3 + Vue3 å¼€å‘å¾®ä¿¡å°ç¨‹åºã€‚

æˆ‘æ ¹æ®ç½‘ä¸Šçš„èµ„æ–™å®Œæˆäº†æœ¬é¡¹ç›®çš„æ­å»ºä¹‹åï¼Œç”¨æœ¬é¡¹ç›®å¼€å‘è¿‡ä¸€ä¸ªå°ç¨‹åºï¼Œé‚£ç§å¼€å‘ä½“éªŒçœŸçš„æ˜¯è¶…è¶Šäº†æˆ‘ä»¥å¾€å¼€å‘è¿‡çš„æ‰€æœ‰é¡¹ç›®ï¼Œéå¸¸ä¸æ»‘ï¼ˆå¯èƒ½æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å†™ vue3 çš„ script setup å§ï¼Œç”¨èµ·æ¥ç¡®å®å¾ˆèˆ’æœï¼‰ã€‚

å¯ç›´æ¥è®¿é—®æœ¬é¡¹ç›® github åœ°å€ clone ä½¿ç”¨ã€‚

## ç›®æ ‡åŠŸèƒ½

- é›†æˆ vue3ï¼Œä½¿ç”¨ `script setup` è¯­æ³•å¼€å‘
- é›†æˆ `Typescript`
- ä»£ç æ£€æŸ¥å’Œæ ¼å¼ä¼˜åŒ–
- å…¨å±€çŠ¶æ€ç®¡ç†
- å°ç¨‹åºåˆ†åŒ…é…ç½®
- æ ·å¼å°è£…ï¼Œå…¼å®¹åˆ˜æµ·å„¿å±ç­‰æ ·å¼é—®é¢˜
- http æ–¹æ³•å°è£…

## ä¸»è¦æŠ€æœ¯æ ˆ

- Taro3
- Vue3
- TypeScript
- NutUi
- Pinia

vue3 åˆšå‘å¸ƒæ—¶ï¼Œç”±äºæ²¡æœ‰åˆé€‚çš„ ui æ¡†æ¶æ”¯æŒï¼Œæˆ‘å­¦ä¹  vue3 çš„çƒ­æƒ…ç›´æ¥è¢«åŠé€€äº†ã€‚ç›´åˆ°ç°åœ¨ï¼Œç±»ä¼¼äº[ quasar](http://www.quasarchs.com/introduction-to-quasar[/)ã€[element-plus](https://element-plus.gitee.io/zh-CN/component/button.html)ã€[ant-design-vue](https://next.antdv.com/docs/vue/migration-v3-cn) ç­‰ä¼˜ç§€æ¡†æ¶é™†ç»­æ”¯æŒ vue3ï¼Œå¹¶ä¸”è®¸å¤š vue3 é¡¹ç›®è¢«ç”¨åˆ°äº†ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‰å‘ç°å¤§å®¶æ˜¯æŠŠ vue3 çœŸçš„ç”¨èµ·æ¥äº†ã€‚

æ¯”å¦‚æˆ‘ä»¬å…¬å¸éš”å£é¡¹ç›®ç»„ï¼Œé‡æ„é¡¹ç›®å°±ç”¨äº† vue3ï¼Œè¿™æ—¶æˆ‘æ‰å‘ç°è‡ªå·±å­¦ä¹  vue3 æœ‰ç‚¹æ™šäº†ï¼ˆtips:å‰ç«¯çœŸçš„å¤ªå·äº† ğŸ˜­ï¼‰

[NutUI](https://nutui.jd.com/#/intro) æ˜¯äº¬ä¸œé£æ ¼çš„ç§»åŠ¨ç«¯ç»„ä»¶åº“ï¼Œå®ƒæ”¯æŒä½¿ç”¨ Vue è¯­è¨€æ¥ç¼–å†™å¯ä»¥åœ¨ H5ï¼Œå°ç¨‹åºå¹³å°ä¸Šçš„åº”ç”¨ï¼Œå¸®åŠ©ç ”å‘äººå‘˜æå‡å¼€å‘æ•ˆç‡ï¼Œæ”¹å–„å¼€å‘ä½“éªŒã€‚

æˆ‘æ˜¯ä» [Taro æ–‡æ¡£](http://taro-docs.jd.com/taro/docs/vue3) çŸ¥é“ NutUI çš„ï¼Œtaro å®˜æ–¹æ¨èä½¿ç”¨ NutUI å¼€å‘ï¼Œä»–ä»¬ä¼¼ä¹ä¹Ÿéƒ½æ˜¯æ¥è‡ªäº¬ä¸œåŒä¸€ä¸ªå¼€å‘å›¢é˜Ÿï¼Œæˆ‘æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€ä¸Šæ‰‹ä½¿ç”¨ï¼Œé…ç½®ç®€å•ï¼Œä½¿ç”¨ä½“éªŒè¿˜ä¸é”™ã€‚

[Pinia](https://pinia.vuejs.org/introduction.html) æ˜¯ä¸€ä¸ªç”¨äº Vue çš„çŠ¶æ€ç®¡ç†åº“ï¼Œç±»ä¼¼ Vuex, æ˜¯ Vue çš„å¦ä¸€ç§çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œæ”¯æŒ Vue2 å’Œ Vue3ã€‚

æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦å‰ç«¯çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œæ˜¯åˆšå®ä¹ æ—¶å…¬å¸çš„ä¸€ä¸ªåå°ç®¡ç†ç³»ç»Ÿï¼Œç”¨çš„ dvaï¼Œé‚£å¯å«ä¸€ä¸ªæŠ˜ç£¨å•Šï¼Œå·®ç‚¹ç›´æ¥æŠŠæˆ‘åŠé€€ã€‚åé¢æ…¢æ…¢ç†Ÿæ‚‰äº†ä¸€äº›ï¼Œä½†æ˜¯ä¸ç®¡ç”¨ reduxï¼Œè¿˜æ˜¯ vuexï¼Œè¿˜æ˜¯è§‰å¾—å†™ç€éº»çƒ¦ã€‚

è¿™æ¬¡å°è¯•ä½¿ç”¨ Piniaï¼Œç”¨èµ·æ¥ç¡®å®å¾ˆèˆ’æœï¼Œç¬¦åˆç›´è§‰ï¼Œæ˜“äºå­¦ä¹  ï¼Œæœ‰ç‚¹ç±»ä¼¼äº [recoil](https://recoiljs.org/zh-hans/docs/introduction/getting-started)ï¼Œä½†æ²¡æœ‰ recoil é‚£ä¹ˆå¤šçš„æ¦‚å¿µå’Œ APIï¼Œä¸»ä½“éå¸¸ç²¾ç®€ï¼Œææ˜“ä¸Šæ‰‹ã€‚[Pinia å¿«é€Ÿå…¥é—¨](https://juejin.cn/post/6986847203885056036)

## vscode éœ€å®‰è£…æ’ä»¶

- Eslint
- Prettier
- Volar

ä¸`vetur`ç›¸åŒï¼Œ`volar`æ˜¯ä¸€ä¸ªé’ˆå¯¹ vue çš„ vscode æ’ä»¶ï¼Œä¸è¿‡ä¸ vetur ä¸åŒçš„æ˜¯ï¼Œvolar æä¾›äº†æ›´ä¸ºå¼ºå¤§çš„åŠŸèƒ½ã€‚

[Volar ä»‹ç»](https://juejin.cn/post/6966106927990308872)

## æ­å»ºé¡¹ç›®æ¶æ„

### åˆå§‹åŒ–é¡¹ç›®

åˆå§‹åŒ–é¡¹ç›®ä¹‹å‰ï¼Œéœ€å®‰è£… taroï¼Œè¯·å‚è€ƒ [Taro æ–‡æ¡£](https://taro-docs.jd.com/taro/docs/GETTING-STARTED)ï¼Œå®Œæˆ taro å®‰è£…

ä½¿ç”¨å‘½ä»¤åˆ›å»ºæ¨¡æ¿é¡¹ç›®ï¼š

```shell
taro init myApp
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/505ed3ea9b024ce88325565409517c7f~tplv-k3u1fbpfcp-watermark.image?)

å®‰è£… cli ç”¨æ¥æ‰§è¡Œæ„å»ºç­‰æ“ä½œï¼Œä¹‹åå¯åŠ¨é¡¹ç›®ï¼Œä¼šç”Ÿæˆä¸€ä¸ª dist ç›®å½•

```shell
yarn add @tarojs/cli
yarn dev:weapp
```

> æ‰“å¼€å¾®ä¿¡å¼€å‘å·¥å…· å·¥ç¨‹ç›®å½•éœ€è¦æŒ‡å‘æ„å»ºå‡ºæ¥çš„ dist æ–‡ä»¶

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/012d563407294fa8aba5e3d4584c33e9~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23af519f936548ab83ecfc27d791fba8~tplv-k3u1fbpfcp-watermark.image?)

Hello world å‡ºç°ï¼Œé¡¹ç›®æˆåŠŸè·‘èµ·æ¥äº†ï¼

### è®¾ç½®ä»£ç è§„èŒƒ

- ä»£ç è§„èŒƒ ESlint
- ä»£ç æ ¼å¼åŒ– Prettier
- æäº¤å‰æ£€æŸ¥ husky

ä¸ªäººè®¤ä¸ºï¼Œeslint + prettier è¶³ä»¥åº”ä»˜å¤§éƒ¨åˆ†å‰ç«¯ä»£ç è§„èŒƒé—®é¢˜äº†ï¼Œä¸”é…ç½®èµ·æ¥å¾ˆç®€å•ï¼Œæœ‰ç‰¹æ®Šéœ€æ±‚ä¹Ÿå¯ç»§ç»­é…ç½®ã€‚

å®‰è£…ä¾èµ–

```shell
yarn add @vue/eslint-config-prettier @vue/eslint-config-typescript eslint-plugin-prettier vue-tsc husky -D
```

è®¾ç½®ä»£ç è§„èŒƒå’Œæ ¼å¼åŒ–è§„åˆ™

.eslintrc.js

```
module.exports = {
  root: true,

  env: {
    node: true,
    'vue/setup-compiler-macros': true
  },

  extends: ['plugin:vue/vue3-essential', 'eslint:recommended', '@vue/prettier', '@vue/typescript'],

  parserOptions: {
    parser: '@typescript-eslint/parser'
  },

  rules: {
    'prettier/prettier': [
      'error',
      {
        singleQuote: true,
        semi: false,
        trailingComma: 'none',
        arrowParens: 'avoid',
        printWidth: 100
      }
    ],
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off'
  }
}

```

.prettierrc

```
{
  "tabWidth": 2,
  "singleQuote": true,
  "semi": false,
  "trailingComma": "none",
  "arrowParens": "avoid",
  "endOfLine": "auto",
  "printWidth": 100
}
```

åœ¨ package.json ä¸­ script æ·»åŠ  Ts æ£€æŸ¥å‘½ä»¤å’Œ Eslint æ£€æŸ¥å‘½ä»¤

```json
"scripts":{
  "tsc": "vue-tsc --noEmit --skipLibCheck",
  "lint": "eslint --ext .vue --ext .js --ext .ts src/"
}
```

æ·»åŠ  [husky](https://github.com/typicode/husky) è§¦å‘ Git é’©å­ï¼Œä»£ç æäº¤å‰æ£€æŸ¥

```
npx husky install
```

ç¼–è¾‘ pre-commit æ‰§è¡Œ Eslint æ£€æŸ¥å’Œ Ts æ£€æŸ¥

```
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "---eslint start---"
npm run lint
echo "---eslint end---"

echo "---ts lint start---"
npm run tsc
echo "---ts lint end---"

```

è‡³æ­¤ï¼Œé¡¹ç›®çš„ä»£ç è§„èŒƒå’Œæ ¼å¼è§„èŒƒé…ç½®å®Œæ¯•ï¼Œå¤šäººåä½œä¹Ÿä¸æ˜¯é—®é¢˜äº†ã€‚

### å¼•å…¥ NutUI

```shell
yarn add @nutui/nutui-taro
```

æŒ‰éœ€å¼•å…¥ï¼Œå®‰è£…æ’ä»¶ babel-plugin-import

```shell
yarn add babel-plugin-import -D
```

æ ·å¼å¤„ç† å› ä¸º nutui çš„è®¾è®¡ç¨¿æ˜¯ 375 çš„ æ‰€ä»¥å°†æ¡†æ¶çš„è®¾è®¡å°ºå¯¸è°ƒæ•´ä¸º 375

é¡¹ç›®é…ç½®æ–‡ä»¶ config/index.js ä¸­é…ç½®:

```js
designWidth: 375
```

app.ts

```
import { createApp } from 'vue';
import { Button } from '@nutui/nutui-taro';

const app = createApp();

app.use(Button);
```

index.vue ä¸­ï¼Œnut-button ç»„ä»¶ç›´æ¥åœ¨ template ä¸­å†™ï¼Œä¸ç”¨å†å¼•å…¥

```
<template>
  <view class="index">
    <text>{{ msg }}</text>
    <nut-button type="primary">ä¸»è¦æŒ‰é’®</nut-button>
  </view>
</template>
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b485827220f4baaa15e6c7c6077ab33~tplv-k3u1fbpfcp-watermark.image?)

### å°ç¨‹åºåˆ†åŒ…é…ç½®

å°ç¨‹åºä¸»åŒ…è¶…è¿‡ 2Mï¼Œå°±æ— æ³•çœŸæœºé¢„è§ˆäº†ï¼Œä¸ºäº†æå‰åšå¥½å‡†å¤‡åœ¨ä¸€å¼€å§‹å°±è¿›è¡Œåˆ†åŒ…å¤„ç†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå°ç¨‹åºçš„é…ç½®ï¼Œåˆ†äº†å››ä¸ªåŒ…ã€‚

app.config.ts

```
pages: ['pages/create/index', 'pages/find/index', 'pages/my/index'],
subpackages: [
{
  root: 'pages/featureA',
  pages: ['index/index']
},
{
  root: 'pagesSub/search',
  pages: ['index']
},
{
  root: 'pagesSub/my',
  pages: ['detail/index', 'about/index']
},
{
  root: 'pagesSub/book',
  pages: ['detail/index', 'person/list/index', 'person/detail/index']
}
],
```

å¯ä»¥åœ¨å°ç¨‹åºå¼€å‘å·¥å…·ç¼–è¾‘å™¨é‡Œçš„ä»£ç ä¾èµ–åˆ†æï¼ŒæŸ¥çœ‹ä¸»åŒ…å’Œåˆ†åŒ…çš„å¤§å°

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da38b9e6463c411792a7ca244782fa12~tplv-k3u1fbpfcp-watermark.image?)

### ä½¿ç”¨ script setup è¯­æ³•å°è£…å°ç¨‹åºé¡µé¢ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

hooks/life.ts

```
import { getCurrentInstance } from '@tarojs/taro'
import { onMounted } from 'vue'

const Current = getCurrentInstance()

export function useDidShow(callback) {
    onMounted(callback) Current?.page?.onShow && (Current.page.onShow = callback)
}
export function usePullDownRefresh(callback) {
    Current?.page?.onPullDownRefresh && (Current.page.onPullDownRefresh = callback)
}
```

ä½¿ç”¨

```
import { useDidShow } from '@/hooks/life'

useDidShow(() => {
  // console.log('onShow')
})
```

### å®‰è£… [Pinia](https://pinia.vuejs.org/introduction.html) è¿›è¡ŒçŠ¶æ€ç®¡ç†

```shell
yarn add pinia
yarn add taro-plugin-pinia

```

é¡¹ç›®é…ç½®æ–‡ä»¶ config/index.js ä¸­é…ç½®:

```js
plugins: ['taro-plugin-pinia']
```

ä»¥ç®¡ç†ç”¨æˆ·ä¿¡æ¯å’Œç”¨æˆ·ç™»å½•çŠ¶æ€ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªç”¨æˆ·ç™»å½•åŠŸèƒ½

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d1acc640d2c4b2aa6be17723c90a555~tplv-k3u1fbpfcp-watermark.image?)

éœ€è¦å¤„ç†çš„æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š

stores/auth.ts

```
import { defineStore } from 'pinia'

interface UserInfoProp {
  nickName: string
  avatarUrl: string
}

const useAuth = defineStore({
  id: 'authInfo',
  state: () => ({
    userInfo: {
      nickName: '',
      avatarUrl: ''
    },
    isLogin: false
  }),
  actions: {
    login() {
      this.isLogin = true
    },
    logout() {
      this.isLogin = false
    },
    setUserInfo(userInfo: UserInfoProp) {
      this.userInfo = userInfo
    }
  }
})
export { useAuth }
```

stores/index.ts

```
import { createPinia } from 'pinia'
import { useAuth } from './auth'

export const store = createPinia()

const storeObj = {
  auth: useAuth
}

// å°è£…æˆuseStoreçš„å½¢å¼ï¼Œè¿™æ ·ä¸€çœ‹å¼•ç”¨å°±çŸ¥é“æ˜¯storeçš„æ•°æ®
export function useStore(key: string) {
  return storeObj[key]()
}
```

ä¸ªäººä¸­å¿ƒ index.vue

```
<template>
  <main v-if="isLogin" class="my-container">
    <user-info />
  </main>
  <main v-else>
    <nut-button type="primary" @click="handleLogin">å¾®ä¿¡ä¸€é”®ç™»å½•</nut-button>
  </main>
</template>

<script lang="ts" setup>
import Taro from '@tarojs/taro'
import { computed } from 'vue'
import { useStore } from '@/stores'

import UserInfo from './userInfo.vue'

const auth = useStore('auth')
const isLogin = computed(() => auth.isLogin)

const handleLogin = () => {
  setTimeout(() => {
    // æ¨¡æ‹Ÿåç«¯è¯·æ±‚å¾—åˆ°tokenå’ŒuserInfo
    Taro.setStorageSync('token', 'xxxx')
    auth.setUserInfo({
      nickName: 'æ—',
      avatarUrl:
        'https://img12.360buyimg.com/imagetools/jfs/t1/143702/31/16654/116794/5fc6f541Edebf8a57/4138097748889987.png'
    })
    auth.login()
  }, 500)
}
</script>

</script>
```

userInfo ç»„ä»¶

```
<template>
  <article class="user-info">
    <nut-avatar size="large" :icon="userInfo.avatarUrl"></nut-avatar>
    <span class="ellipsis name">{{ userInfo.nickName }}</span>
  </article>
</template>

<script lang="ts" setup>
import Taro from '@tarojs/taro'
import { computed } from 'vue'
import { useStore } from '@/stores'

const auth = useStore('auth')
const userInfo = computed(() => auth.userInfo)

</script>
```

æ€»çš„æ¥è¯´ï¼Œ pinia å†™èµ·æ¥æ˜¯éå¸¸ç®€æ´çš„ï¼Œè¿™ç§ç±» react hooks çš„å†™æ³•ï¼Œæˆ‘æ˜¯éå¸¸å–œæ¬¢çš„

### è¯·æ±‚æ–¹æ³•å°è£…

http.ts

```
// å°è£…axiosçš„è¯·æ±‚ï¼Œè¿”å›é‡æ–°å°è£…çš„æ•°æ®æ ¼å¼
// å¯¹é”™è¯¯çš„ç»Ÿä¸€å¤„ç†
import { HttpResponse } from '@/common/interface'
import Taro from '@tarojs/taro'
import publicConfig from '@/config/index'
import axios, {
  AxiosInstance,
  AxiosRequestConfig,
  AxiosResponse,
  Canceler
} from 'axios-miniprogram'
import errorHandle from '../common/errorHandle'
const CancelToken = axios.CancelToken

class HttpRequest {
  private baseUrl: string
  private pending: Record<string, Canceler>

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl
    this.pending = {}
  }

  // è·å–axiosé…ç½®
  getInsideConfig() {
    const config = {
      baseURL: this.baseUrl,
      headers: {
        'Content-Type': 'application/json;charset=utf-8'
      },
      timeout: 10000
    }
    return config
  }

  removePending(key: string, isRequest = false) {
    if (this.pending[key] && isRequest) {
      this.pending[key]('å–æ¶ˆé‡å¤è¯·æ±‚')
    }
    delete this.pending[key]
  }

  // è®¾å®šæ‹¦æˆªå™¨
  interceptors(instance: AxiosInstance) {
    instance.interceptors.request.use(
      config => {
        console.log('config :>> ', config)
        let isPublic = false
        publicConfig.publicPath.map(path => {
          isPublic = isPublic || path.test(config.url || '')
        })
        const token = Taro.getStorageSync('token')
        if (!isPublic && token) {
          config.headers.Authorization = 'Bearer ' + token
        }
        const key = config.url + '&' + config.method
        this.removePending(key, true)
        config.cancelToken = new CancelToken(c => {
          this.pending[key] = c
        })
        return config
      },
      err => {
        errorHandle(err)
        return Promise.reject(err)
      }
    )

    // å“åº”è¯·æ±‚çš„æ‹¦æˆªå™¨
    instance.interceptors.response.use(
      res => {
        const key = res.config.url + '&' + res.config.method
        this.removePending(key)
        if (res.status === 200) {
          return Promise.resolve(res.data)
        } else {
          return Promise.reject(res)
        }
      },
      err => {
        errorHandle(err)
        return Promise.reject(err)
      }
    )
  }

  // åˆ›å»ºå®ä¾‹
  request(options: AxiosRequestConfig) {
    const instance = axios.create()
    const newOptions = Object.assign(this.getInsideConfig(), options)
    this.interceptors(instance)
    return instance(newOptions)
  }

  get(url: string, config?: AxiosRequestConfig): Promise<AxiosResponse> | Promise<HttpResponse> {
    const options = Object.assign(
      {
        method: 'get',
        url: url
      },
      config
    )
    return this.request(options)
  }

  post(url: string, data?: unknown): Promise<AxiosResponse> | Promise<HttpResponse> {
    return this.request({
      method: 'post',
      url: url,
      data: data
    })
  }
}

export default HttpRequest

```

request.ts

```
import HttpRequest from './http'
import config from '@/config/index'
const baseUrl = process.env.NODE_ENV === 'development' ? config.baseUrl.dev : config.baseUrl.pro

const request = new HttpRequest(baseUrl)

export default request
```

ä»¥è·å–å›¾ä¹¦åˆ—è¡¨å’Œå›¾ä¹¦è¯¦æƒ…ä¸ºä¾‹

apis/book.ts

```
import request from '../request'

export function getBookList() {
  return request.get('books/getBookList')
}

export function getBookDetail(id: number) {
  return request.post('books/getBookDetail', {
    id
  })
}

```

è¯·æ±‚æ–¹æ³•å°è£…è¿˜æ˜¯ç”¨åˆ°äº† `axios`ï¼Œåªæ˜¯ç”¨çš„æ˜¯ `axios-miniprogram` ï¼Œå†™æ³•å’Œ web ç«¯åŸºæœ¬ä¸€è‡´ï¼Œhttp.js æ–‡ä»¶å¼•ç”¨çš„ä¸€äº›æ¨¡å—å¤ªå¤šï¼Œæœ¬æ–‡æ²¡æœ‰åˆ—å‡ºæ¥ï¼Œå¯ä»¥ç›´æ¥è®¿é—®æœ¬é¡¹ç›® github åœ°å€æŸ¥çœ‹ã€‚

### æ ·å¼å°è£…

iPhoneX åº•éƒ¨æ¨ªçº¿é€‚é…

assets/styles/common.scss

```
.safe-area-bottom {
  padding-bottom: constant(safe-area-inset-bottom);
  padding-bottom: env(safe-area-inset-bottom);
}
```

åˆ˜æµ·å„¿å±é€‚é…

assets/styles/hairline.scss

```
@mixin hairline-common() {
  position: absolute;
  box-sizing: border-box;
  content: ' ';
  pointer-events: none;
}

@mixin hairline() {
  @include hairline-common();
  top: -50%;
  right: -50%;
  bottom: -50%;
  left: -50%;
  border: 0 solid #eaeaea;
  transform: scale(0.5);
}

@mixin hairline-top($color, $left: 0, $right: 0) {
  @include hairline-common();
  top: 0;
  right: $right;
  left: $left;
  border-top: 1px solid $color;
  transform: scaleY(0.5);
}

@mixin hairline-bottom($color, $left: 0, $right: 0) {
  @include hairline-common();
  right: $right;
  bottom: 0;
  left: $left;
  border-bottom: 1px solid $color;
  transform: scaleY(0.5);
}

[class*='van-hairline'] {
  &::after {
    @include hairline();
  }
}

.van-hairline {
  &,
  &--top,
  &--left,
  &--right,
  &--bottom,
  &--surround,
  &--top-bottom {
    position: relative;
  }

  &--top::after {
    border-top-width: 1px;
  }

  &--left::after {
    border-left-width: 1px;
  }

  &--right::after {
    border-right-width: 1px;
  }

  &--bottom::after {
    border-bottom-width: 1px;
  }

  &,
  &-unset {
    &--top-bottom::after {
      border-width: 1px 0;
    }
  }

  &--surround::after {
    border-width: 1px;
  }
}

```

å¤šè¡Œæ–‡å­—çœç•¥

assets/styles/ellipsis.scss

```
@mixin multi-ellipsis($lines) {
  display: -webkit-box;
  overflow: hidden;
  text-overflow: ellipsis;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
}

@mixin ellipsis() {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

.ellipsis {
  @include ellipsis();
}

.multi-ellipsis--l2 {
  @include multi-ellipsis(2);
}

.multi-ellipsis--l3 {
  @include multi-ellipsis(3);
}

```

## æ€»ç»“

è‡³æ­¤ï¼Œç»ˆäºå®Œæˆäº† Taro + Vue3 çš„é¡¹ç›®æ­å»ºï¼Œå¯ç›´æ¥è®¿é—®é¡¹ç›® [github åœ°å€](https://github.com/wlllyfor/taro-vue3) clone ä½¿ç”¨ï¼Œæœ‰ä¸€äº›é…ç½®ç»†èŠ‚æœ¬æ–‡æ— æ³•ä¸€ä¸€åˆ—ä¸¾ï¼Œå°±åœ¨é¡¹ç›®ä¸­å»å‘æ˜å§ï¼

å¦å¤–ï¼Œæœ¬é¡¹ç›®åŸºæœ¬éƒ½æ˜¯ç…§ç€è¿™ä½å¤§ä½¬çš„é¡¹ç›® [taro3-vue3-template](https://github.com/Yill625/taro3-vue3-template) æ­çš„ï¼Œè°¢è°¢å¤§ä½¬ï¼Œå­¦åˆ°å¾ˆå¤šã€‚ ğŸ™  

æœ¬æ–‡å…¶å®ä¹Ÿåªæ˜¯æˆ‘å­¦ä¹ è¿™ä½å¤§ä½¬æ¶æ„çš„ä¸€äº›è®°å½•å’Œæ€è€ƒï¼Œå¼ºçƒˆå»ºè®®ç›´æ¥è®¿é—®å’Œä½¿ç”¨å¤§ä½¬çš„é¡¹ç›®ï¼Œäººå®¶æ˜¯åŸåˆ›ï¼Œæˆ‘æ˜¯æ¬è¿è¿‡æ¥å†åŠ äº†ç‚¹ä¸œè¥¿ã€‚

å¦‚æœæˆ‘çš„æ–‡ç« èƒ½å¸®åŠ©åˆ°ä½ ï¼Œå°±å»ç»™åŸåˆ›å¤§ä½¬çš„é¡¹ç›® star ä¸€ä¸‹å§ï¼Œ[é¡¹ç›®åœ°å€](https://github.com/Yill625/taro3-vue3-template)

### å‚è€ƒèµ„æ–™

[taro3-vue3-template](https://github.com/Yill625/taro3-vue3-template) 
[taro æ–‡æ¡£](https://taro-docs.jd.com/taro/docs/vue3)  
[NutUI](https://nutui.jd.com/#/intro)  
[Pinia](https://pinia.vuejs.org/introduction.html)  
[Pinia å¿«é€Ÿå…¥é—¨](https://juejin.cn/post/6986847203885056036)  
[Volar ä»‹ç»](https://juejin.cn/post/6966106927990308872)  
[ç½‘é¡µé€‚é… iPhoneXï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•](https://jelly.jd.com/article/6006b1055b6c6a01506c87fd)  
[vant-weapp](https://github.com/youzan/vant-weapp/packages/common/style/hairline.less)
